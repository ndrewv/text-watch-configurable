<!DOCTYPE html>
<html>
	<head>
		<title>TextTime Configuration</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="css/themes/pebble-theme.min.css" />
  		<link rel="stylesheet" href="css/themes/jquery.mobile.icons.min.css" />
		<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" />
		<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
		<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
	</head>
	<body>
		<form name="form" name="form" method="GET">
			<div data-theme="a" data-role="page">
				<div data-role="header" class="jqm-header">
					<h1>Text Time</h1>
				</div>
				<div id="textDiv"></div>
				<div data-role="content">
				<div data-role="fieldcontain">
				<label for="background">Background:</label>
					<fieldset data-role="controlgroup"  name="background" data-type="horizontal">
                        <input type="radio" name="background" id="background_1" value="0"/>
						<label for="background_1">Black</label>
                        <input type="radio" name="background" id="background_2" value="1"/>
						<label for="background_2">White</label>
					</fieldset>
					</div>
					<div data-role="fieldcontain">
						<label for="align">Alignment:</label>
						<select name="align" id="align">
							<option value="0">Left</option>
							<option value="1">Centre</option>
							<option value="2">Right</option>
						</select>
					</div>
					<div data-role="fieldcontain">
						<label for="datestyle">Date Style:</label>
						<select name="datestyle" id="datestyle">
							<option value="0">Month</option>
							<option value="1">Weekday</option>
							<option value="2">No Date</option>
						</select>
					</div>
					<div data-role="fieldcontain">
						<label for="capital">Capitalize Month/Weekday:</label>
						<select name="capital" id="capital" data-role="slider">
							<option value="0">Yes</option>
							<option value="1">No</option>
						</select>
					</div>
					<div data-role="fieldcontain">
						<label for="fontstyle">Font Style:</label>
						<select name="fontstyle" id="fontstyle">
							<option value="0" class="bitham">Bitham (Default)</option>
							<option value="1" class="daniel">Daniel</option>
							<option value="2" class="fineliner">Fineliner</option>
							<option value="3" class="philosopher">Philosopher</option>
							<option value="4" class="retro">Retro</option>
							<option value="5" class="jedi">Star Jedi</option>
							<option value="6" class="stencilia">Stencilia</option>
							<option value="7" class="technique">Technique BRK</option>
							<option value="8" class="visitor">Visitor</option>
							<option value="9" class="florence">Florence Sans</option>
							<option value="10" class="quicksand">Quicksand</option>
							<option value="11" class="college">College</option>
							<option value="12" class="lcd">LCD</option>
							<option value="13" class="archistico">Archistico</option>
							<option value="14" class="eurofurence">Eurofurence</option>
						</select>
					</div>
					<div data-theme="a" data-role="fieldcontain">
						<label for="vertoffset">Vertical Offset (px):</label>
						<select name="vertoffset" id="vertoffset">
							<option value="0">0 (Default)</option>
							<option value="5">5</option>
							<option value="10">10</option>
							<option value="15">15</option>
							<option value="19">19 (1/2 line)</option>
							<option value="25">25</option>
							<option value="30">30</option>
							<option value="38">38 (1 line)</option>
						</select>
					</div>
					<div data-role="fieldcontain">
						<label for="animation">Animation Speed:</label>
						<select name="animation" id="animation">
							<option value="700">Default</option>
							<option value="1000">Slower</option>
							<option value="500">Faster</option>
							<option value="0">None</option>
						</select>
					</div>
					<div class="ui-body ui-body-b">
						<fieldset class="ui-grid-a">
						<div class="ui-block-a"><button id="cancel" onclick="return cancelForm();">Cancel</button></div>
						<div class="ui-block-b"><button id="submit" onclick="return submitForm();">Submit</button></div>
						</fieldset>
					</div>
				</div>
			</div>
		</form>
		<script>
			function getQueryParam(variable, default_) {
			    var query = window.location.search.substring(1);
			    var vars = query.split('&');
			    for (var i = 0; i < vars.length; i++) {
			        var pair = vars[i].split('=');
			        if (pair[0] == variable)
			            return decodeURIComponent(pair[1]);
			    }
			    return default_ || false;
			}
			
			function submitForm(){
			var variables = {};
			var selects=this.form.getElementsByTagName('select');
			//encode selects
			for(var i=0;i<selects.length;i++){
				variables[selects[i].name.toString()]=parseInt(selects[i].value);
			}
			var radios=this.form.getElementsByTagName('input');
			for(var j=0;j<radios.length;j++){
				if(radios[j].checked == true){
					variables[radios[j].parentNode.name.toString()]=parseInt(radios[j].value);	
				}
			}
			console.log(variables);
			console.log(JSON.stringify(variables));
		        var location = return_to+encodeURIComponent(JSON.stringify(variables));
		        console.log(location);
	            	document.location = location;
			}
			function cancelForm(){
				console.log("Cancel");
          			document.location = return_to;
			}
			
			var return_to = getQueryParam('return_to', 'pebblejs://close#');
			var config = getQueryParam('opts', '');
			//decodeURIComponent(window.location.search.substr(1));
			//document.getElementById("textDiv").innerHTML = window.location.search.substr(1);
			console.log(config);
			var obj = JSON.parse(config);
			if(obj!==null){
				for (var key in obj){
	  				if(obj.hasOwnProperty(key)){
						//var element=document.getElementById(key);
						var element=document.getElementByName(key);
						if (element!==null) {
							if(element.length == 1){
								//select
								element[0].value=parseInt(obj[key]);
							}else{
								//radio
								for(var i = 0; i < element.length; element++){
									if(element[i].value == parseInt(obj[key])){
										element[i].checked = true;
										break;
									}
								}
							}
						}
					}
				}
			}
		</script>
	</body>
</html>
